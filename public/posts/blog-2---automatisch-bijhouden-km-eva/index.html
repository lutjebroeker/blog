<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Automatisch KM declaratie bijhouden. | My New Hugo Site</title>
<link rel="icon" href="/favicon.svg" sizes="any" type="image/svg+xml" /><meta property="og:url" content="https://lutjebroeker.github.io/posts/blog-2---automatisch-bijhouden-km-eva/">
  <meta property="og:site_name" content="My New Hugo Site">
  <meta property="og:title" content="Automatisch KM declaratie bijhouden.">
  <meta property="og:description" content="Tutorial: Automatische Kilometerregistratie voor Declaraties met Home Assistant, Node-RED en Obsidian Met deze tutorial stel je een volledige workflow in om automatisch ritten vast te leggen en als maandelijkse Markdown-bestanden in Obsidian bij te houden, gebaseerd op je Home Assistant-data. We gebruiken:
Home Assistant voor odometer- en locatie-data
Node-RED add-on in Home Assistant voor logica en bestandsbeheer
Obsidian voor gestructureerde opslag in je vault
Volg de onderstaande stappen zorgvuldig. Aan het eind van dit artikel kun je al je zakelijke ritten automatisch exporteren naar maandelijkse declaratiebestanden in Obsidian.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-10-09T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-10-09T00:00:00+00:00">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Automatisch KM declaratie bijhouden.">
  <meta name="twitter:description" content="Tutorial: Automatische Kilometerregistratie voor Declaraties met Home Assistant, Node-RED en Obsidian Met deze tutorial stel je een volledige workflow in om automatisch ritten vast te leggen en als maandelijkse Markdown-bestanden in Obsidian bij te houden, gebaseerd op je Home Assistant-data. We gebruiken:
Home Assistant voor odometer- en locatie-data
Node-RED add-on in Home Assistant voor logica en bestandsbeheer
Obsidian voor gestructureerde opslag in je vault
Volg de onderstaande stappen zorgvuldig. Aan het eind van dit artikel kun je al je zakelijke ritten automatisch exporteren naar maandelijkse declaratiebestanden in Obsidian.">

      <link rel="stylesheet" href="/css/root.min.0e732b812b9751962e01a7c4798a1211cd5f8ac8abec7f99793fe306989e459f.css" integrity="sha256-DnMrgSuXUZYuAafEeYoSEc1fisir7H&#43;ZeT/jBpieRZ8=" crossorigin="anonymous">
      <link rel="stylesheet" href="/css/bundle.min.d95a325399a05b50fe47dcf35b8229b8a2a014fcee5435cfb28204c6ac335fc5.css" integrity="sha256-2VoyU5mgW1D&#43;R9zzW4IpuKKgFPzuVDXPsoIExqwzX8U=" crossorigin="anonymous">

      <script src="/js/bundle.cc8ae9952dbfb731affafabdf26e5c60a6910047ff59ccdeaf1daebaa26c8830.js" integrity="sha256-zIrplS2/tzGv&#43;vq98m5cYKaRAEf/Wczerx2uuqJsiDA=" crossorigin="anonymous"></script><script defer src="/js/search/flexsearch.compact.64594b125f7b78bdf4fa8316955922bbebb1cd6baef3f16654bfca20309f18f8.js" integrity="sha256-ZFlLEl97eL30&#43;oMWlVkiu&#43;uxzWuu8/FmVL/KIDCfGPg="></script>
<script defer src="/js/search/search.1d980f84df11f3eb7c8c5f17f541d49a0611608df179dd74fa7f06225eb56ace.js" integrity="sha256-HZgPhN8R8&#43;t8jF8X9UHUmgYRYI3xed10&#43;n8GIl61as4="></script>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Spectral:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,200..800&family=Spectral:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" rel="stylesheet">

</head>
<body class="notransition">
  <div id="container">
    <header id="main-header"><div role="navigation" aria-label="Main">
  <div class="nav-left">
    <a href="https://lutjebroeker.github.io/" style="color: inherit;">My New Hugo Site</a>
  </div>
  <div class="nav-right">
    <div style="position:absolute;width:0px;height:0px;">
      <div id="nav-dropdown-menu" class="hidden" href="#">
    <div class="nav-item">
      <a aria-current="true" class="ancestor" href="/posts/"
      >Posts</a>
    </div>
</div>
    </div>
    <a id="nav-dropdown-button" href="#"><svg width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M4 6H20M4 12H20M4 18H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
</a>
    <div id="nav-menu">
    <div class="nav-item">
      <a aria-current="true" class="ancestor" href="/posts/"
      >Posts</a>
    </div>
</div>
    <a id="theme-switcher" href="#">
<svg class="light-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M12 3V4M12 20V21M4 12H3M6.31412 6.31412L5.5 5.5M17.6859 6.31412L18.5 5.5M6.31412 17.69L5.5 18.5001M17.6859 17.69L18.5 18.5001M21 12H20M16 12C16 14.2091 14.2091 16 12 16C9.79086 16 8 14.2091 8 12C8 9.79086 9.79086 8 12 8C14.2091 8 16 9.79086 16 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>

<svg class="dark-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M3.32031 11.6835C3.32031 16.6541 7.34975 20.6835 12.3203 20.6835C16.1075 20.6835 19.3483 18.3443 20.6768 15.032C19.6402 15.4486 18.5059 15.6834 17.3203 15.6834C12.3497 15.6834 8.32031 11.654 8.32031 6.68342C8.32031 5.50338 8.55165 4.36259 8.96453 3.32996C5.65605 4.66028 3.32031 7.89912 3.32031 11.6835Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
</a>
  </div>
</div>
</header>
    <div class="flex grow">
      <div id="main-pane">
        <main id="main-content"><div class="single-header">
<ol class="breadcrumbs" itemscope itemtype="https://schema.org/BreadcrumbList">
    <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
      <a itemprop="item" href="https://lutjebroeker.github.io/">
        <span itemprop="name">Home</span>
      </a>
      <meta itemprop="position" content='1' />
    </li>
    <span>&nbsp»&nbsp</span>
    <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
      <a itemprop="item" href="https://lutjebroeker.github.io/posts/">
        <span itemprop="name">Posts</span>
      </a>
      <meta itemprop="position" content='2' />
    </li>
    <span>&nbsp»&nbsp</span>
</ol>
<h1>Automatisch KM declaratie bijhouden.</h1><time class="dim" datetime="2025-10-09T00:00:00&#43;00:00">October 9, 2025</time></div>
  <section class="page-section"><h1 id="tutorial-automatische-kilometerregistratie-voor-declaraties-met-home-assistant-node-red-en-obsidian">Tutorial: Automatische Kilometerregistratie voor Declaraties met Home Assistant, Node-RED en Obsidian</h1>
<p>Met deze tutorial stel je een volledige workflow in om automatisch ritten vast te leggen en als maandelijkse Markdown-bestanden in Obsidian bij te houden, gebaseerd op je Home Assistant-data. We gebruiken:</p>
<ul>
<li>
<p>Home Assistant voor odometer- en locatie-data</p>
</li>
<li>
<p>Node-RED add-on in Home Assistant voor logica en bestandsbeheer</p>
</li>
<li>
<p>Obsidian voor gestructureerde opslag in je vault</p>
</li>
</ul>
<p>Volg de onderstaande stappen zorgvuldig. Aan het eind van dit artikel kun je al je zakelijke ritten automatisch exporteren naar maandelijkse declaratiebestanden in Obsidian.</p>
<hr>
<h2 id="1-benodigdheden-en-voorbereiding">1. Benodigdheden en Voorbereiding</h2>
<ol>
<li>
<p><strong>Home Assistant setup</strong></p>
<ul>
<li>
<p>Zorg dat je Home Assistant draait met de Node-RED add-on geïnstalleerd.</p>
</li>
<li>
<p>Je hebt een odometer-sensor, bijvoorbeeld <code>sensor.kona_odometer</code>, die de totaalstand van je auto bijhoudt.</p>
</li>
<li>
<p>Je hebt een presence- of zone-entiteit, bijvoorbeeld <code>person.eva</code> of <code>device_tracker.eva</code>, met minimaal de zones <code>home</code> en <code>work</code>.</p>
</li>
<li>
<p>Maak een helper <code>input_boolean.werkdag_eva</code> om aan te geven wanneer ritten daadwerkelijk voor werk(declaratie) zijn.</p>
</li>
</ul>
</li>
<li>
<p><strong>Obsidian vault</strong></p>
<ul>
<li>
<p>Kies of maak een map in je Obsidian vault, bijvoorbeeld:<br>
<code>/home/obsidian/Documents/PersonalAssistant/13. Knowledge/Declaratie/</code></p>
</li>
<li>
<p>Hier komen straks je maand-MD-bestanden zoals <code>2025-10.md</code>.</p>
</li>
</ul>
</li>
</ol>
<hr>
<h2 id="2-flow-1-ritgegevens-berekenen-en-versturen">2. Flow 1: Ritgegevens berekenen en versturen</h2>
<h2 id="21-helpers-in-home-assistant">2.1 Helpers in Home Assistant</h2>
<ol>
<li>
<p><strong>Rit-start automation</strong></p>
<ul>
<li>
<p>Trigger: <code>person.eva</code> verlaat zone <code>home</code>.</p>
</li>
<li>
<p>Action:</p>
<ul>
<li>
<p>Sla de huidige odometer-stand op in een <code>input_number.rit_start_odometer</code>.</p>
</li>
<li>
<p>Zet <code>input_boolean.werkdag_eva</code> op <code>on</code> als het een werkdag is (optioneel via time-based automation).</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Rit-stop automation</strong></p>
<ul>
<li>
<p>Trigger: <code>person.eva</code> keert terug naar zone <code>home</code>.</p>
</li>
<li>
<p>Condition: <code>input_boolean.werkdag_eva</code> is <code>on</code>.</p>
</li>
<li>
<p>Action:</p>
<ul>
<li>
<p>Bereken eind-km, begin-km en verschil:</p>
<p>text</p>
<p><code>km_start: &quot;{{ states('input_number.rit_start_odometer')|float }}&quot; km_eind: &quot;{{ states('sensor.kona_odometer')|float }}&quot; km_verschil: &quot;{{ (states('sensor.kona_odometer')|float - states('input_number.rit_start_odometer')|float)|round(2) }}&quot; date: &quot;{{ now().strftime('%Y-%m-%d') }}&quot;</code></p>
</li>
<li>
<p>Verstuur deze data via een REST-command naar Node-RED endpoint <code>/write_declaration_km</code>.</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>REST-command</strong><br>
Voeg in <code>configuration.yaml</code> toe:</p>
<p>text</p>
<p><code>rest_command:   write_declaration_km:    url: &quot;http://&lt;HA-IP&gt;:1880/write_declaration_km&quot;    method: POST    content_type: application/json    payload: &gt;      {&quot;date&quot;:&quot;{{ date }}&quot;,       &quot;km_start&quot;:{{ km_start }},       &quot;km_eind&quot;:{{ km_eind }},       &quot;km_verschil&quot;:{{ km_verschil }}}</code></p>
</li>
</ol>
<hr>
<h2 id="3-flow-2-node-red--maandbestand-aanmaken-of-updaten">3. Flow 2: Node-RED – Maandbestand aanmaken of updaten</h2>
<p>Importeer in Node-RED de volgende flow:</p>
<p>json</p>
<p><code>[   {     &quot;id&quot;:&quot;cdf733678090f59a&quot;,&quot;type&quot;:&quot;http in&quot;,&quot;url&quot;:&quot;/write_declaration_km&quot;,&quot;method&quot;:&quot;post&quot;,&quot;x&quot;:140,&quot;y&quot;:200,     &quot;wires&quot;:[[&quot;827374a7eff8ae40&quot;]]   },   {     &quot;id&quot;:&quot;827374a7eff8ae40&quot;,&quot;type&quot;:&quot;function&quot;,&quot;name&quot;:&quot;Prepare filename&quot;,     &quot;func&quot;:&quot;const info=msg.payload;\nconst prefix='/home/obsidian/Documents/PersonalAssistant/13. Knowledge/Declaratie/';\nmsg.filename=`${prefix}${info.date.slice(0,7)}.md`;\nreturn msg;&quot;,&quot;x&quot;:380,&quot;y&quot;:200,     &quot;wires&quot;:[[&quot;file_in_check&quot;]]   },   {     &quot;id&quot;:&quot;file_in_check&quot;,&quot;type&quot;:&quot;file in&quot;,&quot;name&quot;:&quot;Check file exists&quot;,&quot;filename&quot;:&quot;&quot;,&quot;filenameType&quot;:&quot;msg&quot;,     &quot;format&quot;:&quot;utf8&quot;,&quot;sendError&quot;:true,&quot;x&quot;:620,&quot;y&quot;:200,&quot;wires&quot;:[[&quot;file_exists_switch&quot;]]   },   {     &quot;id&quot;:&quot;file_exists_switch&quot;,&quot;type&quot;:&quot;switch&quot;,&quot;name&quot;:&quot;Bestaat bestand?&quot;,&quot;property&quot;:&quot;error&quot;,&quot;rules&quot;:[{&quot;t&quot;:&quot;undefined&quot;},{&quot;t&quot;:&quot;else&quot;}],     &quot;outputs&quot;:2,&quot;x&quot;:860,&quot;y&quot;:200,     &quot;wires&quot;:[[&quot;prepare_row&quot;],[&quot;make_header&quot;]]   },   {     &quot;id&quot;:&quot;make_header&quot;,&quot;type&quot;:&quot;function&quot;,&quot;name&quot;:&quot;Maak header&quot;,     &quot;func&quot;:&quot;const maand=msg.filename.slice(-7,-3);\nmsg.payload=`# Declaratie ${maand}\\n\\n`+\n  `| Dag | KM Begin | KM Eind | Te Declareren |\\n`+\n`| --- | -------- | ------- | ------------- |\\n`;\nreturn msg;&quot;,&quot;x&quot;:1120,&quot;y&quot;:160,     &quot;wires&quot;:[[&quot;append_header&quot;,&quot;prepare_row&quot;]]   },   {     &quot;id&quot;:&quot;append_header&quot;,&quot;type&quot;:&quot;file&quot;,&quot;name&quot;:&quot;Write header&quot;,     &quot;filename&quot;:&quot;&quot;,&quot;filenameType&quot;:&quot;msg&quot;,&quot;overwriteFile&quot;:&quot;true&quot;,&quot;appendNewline&quot;:false,&quot;encoding&quot;:&quot;utf8&quot;,&quot;x&quot;:1400,&quot;y&quot;:160,&quot;wires&quot;:[]   },   {     &quot;id&quot;:&quot;prepare_row&quot;,&quot;type&quot;:&quot;function&quot;,&quot;name&quot;:&quot;Prepare row&quot;,     &quot;func&quot;:&quot;const info=msg.payload;\nconst dag=info.date.split('-')[2];\nmsg.payload=`| ${info.date} | ${info.km_start} | ${info.km_eind} | ${info.km_verschil} |`;\nreturn msg;&quot;,&quot;x&quot;:1120,&quot;y&quot;:240,     &quot;wires&quot;:[[&quot;append_row&quot;]]   },   {     &quot;id&quot;:&quot;append_row&quot;,&quot;type&quot;:&quot;file&quot;,&quot;name&quot;:&quot;Append row&quot;,&quot;filename&quot;:&quot;&quot;,&quot;filenameType&quot;:&quot;msg&quot;,     &quot;appendNewline&quot;:true,&quot;overwriteFile&quot;:&quot;false&quot;,&quot;encoding&quot;:&quot;utf8&quot;,&quot;x&quot;:1400,&quot;y&quot;:240,&quot;wires&quot;:[[&quot;ecfd6ebf267f3d5a&quot;]]   },   {     &quot;id&quot;:&quot;ecfd6ebf267f3d5a&quot;,&quot;type&quot;:&quot;http response&quot;,&quot;statusCode&quot;:&quot;200&quot;,     &quot;headers&quot;:{&quot;Content-Type&quot;:&quot;application/json&quot;},&quot;x&quot;:1620,&quot;y&quot;:200,&quot;wires&quot;:[]   } ]</code></p>
<h2 id="uitleg-per-node">Uitleg per node</h2>
<ol>
<li>
<p><strong>HTTP In</strong>: Luistert op POST <code>/write_declaration_km</code>.</p>
</li>
<li>
<p><strong>Prepare filename</strong>: Berekent het maand-MD-bestand op basis van <code>date.slice(0,7)</code>.</p>
</li>
<li>
<p><strong>File In</strong>: Probeert het bestand te lezen; bij fout (<code>sendError=true</code>) volgt de tweede tak.</p>
</li>
<li>
<p><strong>Switch</strong>: Splitst in “bestaat” (geen error) en “bestaat niet” (error).</p>
</li>
<li>
<p><strong>Maak header</strong>: Genereert de tabelkop in Markdown met de kolomtitels.</p>
</li>
<li>
<p><strong>Write header</strong>: Schrijft de header alleen bij nieuwe bestanden (overwrite).</p>
</li>
<li>
<p><strong>Prepare row</strong>: Maakt de rij met dag en km-waarden.</p>
</li>
<li>
<p><strong>Append row</strong>: Voegt de rij altijd toe met een newline.</p>
</li>
<li>
<p><strong>HTTP Response</strong>: Bevestigt de succesvolle oproep aan Home Assistant.</p>
</li>
</ol>
<hr>
<h2 id="4-testen-en-validatie">4. Testen en Validatie</h2>
<ol>
<li>
<p>Zet je <code>input_boolean.werkdag_eva</code> op <code>on</code>.</p>
</li>
<li>
<p>Simuleer vertrek en aankomst in Home Assistant of verlaat en betreed de <code>home</code> zone met je telefoon.</p>
</li>
<li>
<p>Controleer of in <code>/home/obsidian/.../Declaratie/</code> een nieuw bestand verschijnt of een bestaande file wordt uitgebreid.</p>
</li>
<li>
<p>Open het maand-MD-bestand in Obsidian; je ziet vanzelf de tabel met je ritten als rijen onder de header.</p>
</li>
</ol>
<hr>
<h2 id="5-vragen-en-maatwerk">5. Vragen en Maatwerk</h2>
<ul>
<li>
<p>Wil je de tabel in Obsidian automatisch herordenen op datum?</p>
</li>
<li>
<p>Wil je extra kolommen zoals project of kostenplaats?</p>
</li>
<li>
<p>Heb je een andere opslaglocatie of YAML-frontmatter nodig?</p>
</li>
</ul>
<p>Laat het weten, dan help ik je de flow verder aan te passen. Veel succes met je geautomatiseerde kilometerdeclaratie!</p>
</section></main>
        <footer id="main-footer"><div class="footer">
  <a href="#">Scroll to Top</a>
  <div class="footer-copyright">
    <div class="dim">© 2025 </div>
    <div>Made with ❤️ and powered by <a href="https://github.com/math-queiroz/rusty-typewriter" target="_blank">Rusty Typewriter</a> theme for <a href="https://gohugo.io/" target="_blank">Hugo</a></div>
  </div>
</div>
</footer>
      </div><aside id="side-pane" class="side-sticky"><div class="side-details">
    <span>593 words</span>
    <span>6 - 7 minutes read</span></div><h3>Table Of Contents</h3><nav id="TableOfContents">
  <ul>
    <li><a href="#1-benodigdheden-en-voorbereiding">1. Benodigdheden en Voorbereiding</a></li>
    <li><a href="#2-flow-1-ritgegevens-berekenen-en-versturen">2. Flow 1: Ritgegevens berekenen en versturen</a></li>
    <li><a href="#21-helpers-in-home-assistant">2.1 Helpers in Home Assistant</a></li>
    <li><a href="#3-flow-2-node-red--maandbestand-aanmaken-of-updaten">3. Flow 2: Node-RED – Maandbestand aanmaken of updaten</a></li>
    <li><a href="#uitleg-per-node">Uitleg per node</a></li>
    <li><a href="#4-testen-en-validatie">4. Testen en Validatie</a></li>
    <li><a href="#5-vragen-en-maatwerk">5. Vragen en Maatwerk</a></li>
  </ul>
</nav></aside></div>
  </div>
</body>
</html>
