<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>How to automaticly log your workday kilometres | Blog van Jelle</title>
<link rel="icon" href="/favicon.svg" sizes="any" type="image/svg+xml" /><meta property="og:url" content="https://lutjebroeker.github.io/posts/how-to-automaticly-log-your-workday-kilometres/">
  <meta property="og:site_name" content="Blog van Jelle">
  <meta property="og:title" content="How to automaticly log your workday kilometres">
  <meta property="og:description" content="Introduction My wife needs to fill in all kilometers she rode during workdays. Using Node-Red, Obsidian and Home Assistant I log this automatically! Saving us around 15 minutes every workday. We do this with the following steps.
Log the odometer of the car when my wive leaves home. If she arrives at here office sometime after leaving the house, mark today as a workday. When it’s a workday, at arrival home. Store the odometer again. And calcualte thge difference with when she left. Write the date, start KM, end Km and differnence in the table within obisidna. (of course the file will be created when it’s not already there.) Prerequisites [Home Assistant ](Home Assistant) [Node-Red Add-on](hassio-addons/addon-node-red: Node-RED - Home Assistant Community Add-ons) [Mobile Companion App](Home Assistant Companion Docs) [Hyundia Kia Connect - HACS Intergration](Hyundai-Kia-Connect/kia_uvo: A Home Assistant HACS integration that supports Kia Connect(Uvo) and Hyundai Bluelink. The integration supports the EU, Canada and the USA.) [Obsidian](Obsidian - Sharpen your thinking) [Node-Red](Low-code programming for event-driven applications : Node-RED) (With acces to the obsidian files) Walktrough Assuming you have evrything in the prerequisities setup.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-10-11T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-10-11T00:00:00+00:00">
    <meta property="article:tag" content="Node-Red">
    <meta property="article:tag" content="HomeAssistant">
    <meta property="article:tag" content="Obsidian">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="How to automaticly log your workday kilometres">
  <meta name="twitter:description" content="Introduction My wife needs to fill in all kilometers she rode during workdays. Using Node-Red, Obsidian and Home Assistant I log this automatically! Saving us around 15 minutes every workday. We do this with the following steps.
Log the odometer of the car when my wive leaves home. If she arrives at here office sometime after leaving the house, mark today as a workday. When it’s a workday, at arrival home. Store the odometer again. And calcualte thge difference with when she left. Write the date, start KM, end Km and differnence in the table within obisidna. (of course the file will be created when it’s not already there.) Prerequisites [Home Assistant ](Home Assistant) [Node-Red Add-on](hassio-addons/addon-node-red: Node-RED - Home Assistant Community Add-ons) [Mobile Companion App](Home Assistant Companion Docs) [Hyundia Kia Connect - HACS Intergration](Hyundai-Kia-Connect/kia_uvo: A Home Assistant HACS integration that supports Kia Connect(Uvo) and Hyundai Bluelink. The integration supports the EU, Canada and the USA.) [Obsidian](Obsidian - Sharpen your thinking) [Node-Red](Low-code programming for event-driven applications : Node-RED) (With acces to the obsidian files) Walktrough Assuming you have evrything in the prerequisities setup.">

      <link rel="stylesheet" href="/css/root.min.0e732b812b9751962e01a7c4798a1211cd5f8ac8abec7f99793fe306989e459f.css" integrity="sha256-DnMrgSuXUZYuAafEeYoSEc1fisir7H&#43;ZeT/jBpieRZ8=" crossorigin="anonymous">
      <link rel="stylesheet" href="/css/bundle.min.d95a325399a05b50fe47dcf35b8229b8a2a014fcee5435cfb28204c6ac335fc5.css" integrity="sha256-2VoyU5mgW1D&#43;R9zzW4IpuKKgFPzuVDXPsoIExqwzX8U=" crossorigin="anonymous">

      <script src="/js/bundle.cc8ae9952dbfb731affafabdf26e5c60a6910047ff59ccdeaf1daebaa26c8830.js" integrity="sha256-zIrplS2/tzGv&#43;vq98m5cYKaRAEf/Wczerx2uuqJsiDA=" crossorigin="anonymous"></script><script defer src="/js/search/flexsearch.compact.64594b125f7b78bdf4fa8316955922bbebb1cd6baef3f16654bfca20309f18f8.js" integrity="sha256-ZFlLEl97eL30&#43;oMWlVkiu&#43;uxzWuu8/FmVL/KIDCfGPg="></script>
<script defer src="/js/search/search.1d980f84df11f3eb7c8c5f17f541d49a0611608df179dd74fa7f06225eb56ace.js" integrity="sha256-HZgPhN8R8&#43;t8jF8X9UHUmgYRYI3xed10&#43;n8GIl61as4="></script>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Spectral:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,200..800&family=Spectral:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" rel="stylesheet">

</head>
<body class="notransition">
  <div id="container">
    <header id="main-header"><div role="navigation" aria-label="Main">
  <div class="nav-left">
    <a href="https://lutjebroeker.github.io/" style="color: inherit;">Blog van Jelle</a>
  </div>
  <div class="nav-right">
    <div style="position:absolute;width:0px;height:0px;">
      <div id="nav-dropdown-menu" class="hidden" href="#">
    <div class="nav-item">
      <a aria-current="true" class="ancestor" href="/posts/"
      >Posts</a>
    </div>
</div>
    </div>
    <a id="nav-dropdown-button" href="#"><svg width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M4 6H20M4 12H20M4 18H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
</a>
    <div id="nav-menu">
    <div class="nav-item">
      <a aria-current="true" class="ancestor" href="/posts/"
      >Posts</a>
    </div>
</div>
    <a id="theme-switcher" href="#">
<svg class="light-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M12 3V4M12 20V21M4 12H3M6.31412 6.31412L5.5 5.5M17.6859 6.31412L18.5 5.5M6.31412 17.69L5.5 18.5001M17.6859 17.69L18.5 18.5001M21 12H20M16 12C16 14.2091 14.2091 16 12 16C9.79086 16 8 14.2091 8 12C8 9.79086 9.79086 8 12 8C14.2091 8 16 9.79086 16 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>

<svg class="dark-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M3.32031 11.6835C3.32031 16.6541 7.34975 20.6835 12.3203 20.6835C16.1075 20.6835 19.3483 18.3443 20.6768 15.032C19.6402 15.4486 18.5059 15.6834 17.3203 15.6834C12.3497 15.6834 8.32031 11.654 8.32031 6.68342C8.32031 5.50338 8.55165 4.36259 8.96453 3.32996C5.65605 4.66028 3.32031 7.89912 3.32031 11.6835Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
</a>
  </div>
</div>
</header>
    <div class="flex grow">
      <div id="main-pane">
        <main id="main-content"><div class="single-header">
<ol class="breadcrumbs" itemscope itemtype="https://schema.org/BreadcrumbList">
    <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
      <a itemprop="item" href="https://lutjebroeker.github.io/">
        <span itemprop="name">Home</span>
      </a>
      <meta itemprop="position" content='1' />
    </li>
    <span>&nbsp»&nbsp</span>
    <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
      <a itemprop="item" href="https://lutjebroeker.github.io/posts/">
        <span itemprop="name">Posts</span>
      </a>
      <meta itemprop="position" content='2' />
    </li>
    <span>&nbsp»&nbsp</span>
</ol>
<h1>How to automaticly log your workday kilometres</h1><time class="dim" datetime="2025-10-11T00:00:00&#43;00:00">October 11, 2025</time><div class="term-container"><div class="tag">
        <a href="https://lutjebroeker.github.io/tags/node-red/">#Node-Red</a>
      </div><div class="tag">
        <a href="https://lutjebroeker.github.io/tags/homeassistant/">#HomeAssistant</a>
      </div><div class="tag">
        <a href="https://lutjebroeker.github.io/tags/obsidian/">#Obsidian</a>
      </div></ol></div>
  <section class="page-section"><h1 id="introduction">Introduction</h1>
<p>My wife needs to fill in all kilometers she rode during workdays. Using Node-Red, Obsidian and Home Assistant I log this automatically! Saving us around 15 minutes every workday. We do this with the following steps.</p>
<ol>
<li>Log the odometer of the car when my wive leaves home.</li>
<li>If she arrives at here office sometime after leaving the house, mark today as a workday.</li>
<li>When it&rsquo;s a workday, at arrival home. Store the odometer again. And calcualte thge difference with when she left.</li>
<li>Write the date, start KM, end Km and differnence in the table within obisidna. (of course the file will be created when it&rsquo;s not already there.)</li>
</ol>
<h1 id="prerequisites">Prerequisites</h1>
<ul>
<li>[Home Assistant ](<a href="https://www.home-assistant.io/">Home Assistant</a>)
<ul>
<li>[Node-Red Add-on](<a href="https://github.com/hassio-addons/addon-node-red">hassio-addons/addon-node-red: Node-RED - Home Assistant Community Add-ons</a>)</li>
<li>[Mobile Companion App](<a href="https://companion.home-assistant.io/">Home Assistant Companion Docs</a>)</li>
<li>[Hyundia Kia Connect - HACS Intergration](<a href="https://github.com/Hyundai-Kia-Connect/kia_uvo">Hyundai-Kia-Connect/kia_uvo: A Home Assistant HACS integration that supports Kia Connect(Uvo) and Hyundai Bluelink. The integration supports the EU, Canada and the USA.</a>)</li>
</ul>
</li>
<li>[Obsidian](<a href="https://obsidian.md/">Obsidian - Sharpen your thinking</a>)</li>
<li>[Node-Red](<a href="https://nodered.org/">Low-code programming for event-driven applications : Node-RED</a>) (With acces to the obsidian files)</li>
</ul>
<h1 id="walktrough">Walktrough</h1>
<p>Assuming you have evrything in the prerequisities setup.</p>
<ol>
<li>A home assisant instance with the node-red addon, a way to read your car&rsquo;s odometer (for me Hyundia/Kia Connect) and a way to track your location (for me the companion app).</li>
<li>An instance of obsidian and node-red running on that machine as well so it can access the files.
We can start the automation process.</li>
</ol>
<h2 id="stap-1-setup--installatie">Stap 1: Setup &amp; Installatie</h2>
<h3 id="steps-within-home-assistant">Steps within Home Assistant</h3>
<ol>
<li>Use [this tutorial](<a href="https://www.home-assistant.io/integrations/zone/">Zone - Home Assistant</a>) to create a zone for both your home and your work.</li>
<li>Create an boolean helper called Workday.</li>
<li>
<ol start="2">
<li>Within the Home Assistant Node Red instance, create the following flows.</li>
</ol>
</li>
</ol>
<h4 id="1-log-the-odometer-of-the-car-when-my-wive-leaves-home">1. Log the odometer of the car when my wive leaves home</h4>
<ul>
<li>
<p>Create a Zone node that triggers when you leave the zone &ldquo;Home&rdquo;.</p>
</li>
<li>
<p>Create a function node that stores the current state of the odometer.</p>
<p><code>const kmStand = parseFloat(global.get('homeassistant').homeAssistant.states['sensor.kona_odometer'].state);</code>
<code>flow.set(&quot;rit_km_start&quot;, kmStand);</code>
<code>msg.payload = Vertrek opgeslagen: ${kmStand} km;</code>
<code>return msg;</code></p>
</li>
</ul>
<h4 id="2-log-when-arriving-at-work">2. Log when arriving at work</h4>
<ul>
<li>Create a Zone node that triggers when you enter the zone &ldquo;Work&rdquo;.</li>
<li>Create an Edit Action Node that sets the input boolean &ldquo;Workday&rdquo; to true</li>
</ul>
<h4 id="3-log-when-arrving-back-home">3. Log when arrving back home</h4>
<ul>
<li>Create a Zone node that triggers when you enter the zone &ldquo;home&rdquo;.</li>
<li>Create a function node, this node will do several things
<ul>
<li>
<p>Retrive earlier stored data</p>
</li>
<li>
<p>Store the odometer at the end of the workday.</p>
</li>
<li>
<p>Calculate the difference between departure and arrival.</p>
</li>
<li>
<p>Set the date of today.</p>
</li>
<li>
<p>Delete temporarly stored data</p>
<p><code>const kmStart = flow.get(&quot;rit_km_start&quot;) || 0;</code>
<code>const kmEind = parseFloat(global.get('homeassistant').homeAssistant.states['sensor.kona_odometer'].state);</code>
<code>const verschil = (kmEind - kmStart).toFixed(2);</code>
<code>const eindTijd = new Date().toISOString();</code></p>
<p><code>msg.payload = {</code>
<code>datum: eindTijd.split('T')[0],</code>
<code>km_start: kmStart,</code>
<code>km_eind: kmEind,</code>
<code>km_verschil: verschil</code>
<code>};</code></p>
<p><code>flow.set(&quot;rit_km_start&quot;, null);</code>
<code>flow.set(&quot;rit_starttijd&quot;, null);</code>
<code>return msg;</code></p>
</li>
</ul>
</li>
<li>Create an edit current state node to check if the workday boolean is true.</li>
<li>Create a function node to create the API data</li>
<li>Create a http request node to call the Node Red instance with local file access.</li>
<li>Create an edit current state node to set the workday boolean to false.</li>
</ul>
<h3 id="steps-within-obsidian">Steps within Obsidian</h3>
<p>Within Obsidian, create a Declaration folder. This is where we will store our monthly files with our logged kilometers.</p>
<h3 id="steps-within-the-obsidian-node-red-instance">Steps within the Obsidian Node-Red instance</h3>
<ol>
<li>Create a edit http in node, with a post method for the API call we created before. My url is /write_declaration_km</li>
<li>Create a function node to prepare the filename. Make sure the prefix points to the declaration folder you&rsquo;ve created earlier.
<code>const info = msg.payload;</code>
<code>const prefix = '/home/obsidian/Documents/PersonalAssistant/13. Knowledge/Declaratie/';</code>
<code>msg.filename = ${prefix}${info.date.slice(0,7)}.md;</code>
<code>return msg;</code></li>
<li>Create a function node to prepare the row with the declaration information.
<code>const info = msg.payload;</code>
<code>const dataRow = | ${info.date} | ${info.km_start} | ${info.km_eind} | ${info.km_verschil} |;</code>
<code>flow.set(&quot;dataRow&quot;, dataRow);</code>
<code>return msg;</code></li>
<li>Create a read file node to check if msg.filename exists.</li>
<li>Create a function node to reload the row data
<code>const dataRow = flow.get(&quot;dataRow&quot;) || &quot;&quot;;</code>
<code>msg.payload = dataRow;</code>
<code>return msg;</code></li>
<li>Create a write file node to msg.filename and append to file. I&rsquo;ve checked the &ldquo;add newline (\n) to each payload?&rdquo;</li>
<li>Create a http repsonse node with status code 200 to let our caller know everything was ok.</li>
</ol>
<p>Next we will need some error handling, in case the check on step 4 notices that the file did not exist.</p>
<ol>
<li>Create a edit catch node. And only catch errors from the &ldquo;Check file exists&rdquo; node.</li>
<li>Create a function node to create the header of our file.
<code>const maand = msg.filename;</code>
<code>msg.payload = Â  | Dag | KM Begin | KM Eind | Te Declareren |\n +</code>
  <code>| --- | -------- | ------- | ------------- |\n;</code>
<code>return msg;</code></li>
<li>Create a write file node to msg.filename where we overwrite the file.</li>
</ol>
<p>Thats all the steps we need! Now we can start testing.</p>
<h2 id="stap-3-validation--testing">Stap 3: Validation &amp; Testing.</h2>
<ol>
<li>For testing purposes. I&rsquo;ve created a inject node for each of the flows (Leave home, Arrive at work and Arrive home.)</li>
<li>One by one I will start these manually.</li>
<li>Open Obsidian to see your newly created file with the logged kilometers!</li>
</ol>
<h1 id="conclusion">Conclusion</h1>
<p>This was a real fun project for me which acuatlly saves me quite some time. No more manual labor to find out the different states of the odometer and calcualte the kilometers driven for me. Hopefully you found it usefull as well.</p>
<p>I&rsquo;m aware I&rsquo;ve overcomplicated things with two separate Node-Red instances. But that&rsquo;s because of the nature of my Homelab setup. If the file are stored one the same machine you can remove the API call steps.</p>
<p>Thanks for reading!</p>
</section></main>
        <footer id="main-footer"><div class="footer">
  <a href="#">Scroll to Top</a>
  <div class="footer-copyright">
    <div class="dim">© 2025 </div>
    <div>Made with ❤️ and powered by <a href="https://github.com/math-queiroz/rusty-typewriter" target="_blank">Rusty Typewriter</a> theme for <a href="https://gohugo.io/" target="_blank">Hugo</a></div>
  </div>
</div>
</footer>
      </div><aside id="side-pane" class="side-sticky"><div class="side-details">
    <span>919 words</span>
    <span>5 - 7 minutes read</span></div><h3>Table Of Contents</h3><nav id="TableOfContents">
  <ul>
    <li><a href="#stap-1-setup--installatie">Stap 1: Setup &amp; Installatie</a>
      <ul>
        <li><a href="#steps-within-home-assistant">Steps within Home Assistant</a></li>
        <li><a href="#steps-within-obsidian">Steps within Obsidian</a></li>
        <li><a href="#steps-within-the-obsidian-node-red-instance">Steps within the Obsidian Node-Red instance</a></li>
      </ul>
    </li>
    <li><a href="#stap-3-validation--testing">Stap 3: Validation &amp; Testing.</a></li>
  </ul>
</nav></aside></div>
  </div>
</body>
</html>
